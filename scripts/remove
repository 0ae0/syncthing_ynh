#!/bin/bash

SYNCHOME="/home/yunohost.syncthing"
SYNCUSER=debian-syncthing
SYNCPORT=22000

# Stop and remove syncthing service
sudo service syncthing stop
sudo yunohost service remove syncthing
sudo update-rc.d -f syncthing remove
sudo rm -f /etc/init.d/syncthing

# Remove syncthing binairy
sudo apt-get autoremove syncthing -y
sudo rm /etc/apt/sources.list.d/syncthing-release.list
sudo apt-get update

# Backup syncthign SYNCHOME directory
sudo mv $SYNCHOME $SYNCHOME.old
# sudo rm -rf $SYNCHOME

# Remove syncthing user
sudo userdel $SYNCUSER

# Close port in firewall
sudo yunohost firewall disallow TCP $SYNCPORT

# Remove syncthing logrotate configuration
if [ -f /etc/logrotate.d/syncthing ]
then
    sudo rm /etc/logrotate.d/syncthing
fi

# Remove syncthing nginx configuration
domain=$(sudo yunohost app setting syncthing domain)
sudo rm /etc/nginx/conf.d/$domain.d/syncthing.conf

# Reload nginx and update ssowatch
sudo service nginx reload
sudo yunohost app ssowatconf
